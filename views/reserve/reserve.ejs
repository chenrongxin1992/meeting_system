<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>会议室申请</title>

    <!-- Bootstrap -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->
    <link rel='stylesheet' href='/stylesheets/bootstrapValidator.min.css' />
    <link rel='stylesheet' href='/stylesheets/jquery-ui.css' />
    <link rel='stylesheet' href='/stylesheets/bootstrap-select.css' />
    <style type="text/css">
      h3{
        padding-top: 10px;
      }
      .apply_form{
        height: 30px;
        line-height: 30px;
      }
      hr{
        margin-bottom: 20px;
        border: 0;
        border-top: 1px solid #d0a8a8;
        margin-top: 0px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-5 col-md-offset-1">
          <img src="/images/szucsselogo.png" class="img-responsive" alt="Responsive image"/>
          
        </div>
        <div class="col-md-5"><h3>会议室申请系统</h3></div>
      </div>
      <div class="row apply_form">
        <div class="col-md-4 col-md-offset-4"><h4>会议室申请表</h4></div>
      </div>

      <div class="row">
        <div class="col-sm-7 col-sm-offset-1"><hr></div>
      </div>

      <form class="form-horizontal" role="form">

        <div class="form-group">
          <label for="room_name" class="col-sm-2 col-sm-offset-1 control-label">会议室</label>
          <div class="col-sm-4">
            <select id="room_name" class="selectpicker" data-hide-disabled="true" data-live-search="false">
                  <% for(let i=0;i<data.length;i++) { %>
                    <option><%=data[i]%></option>
                  <% } %>
              </select>
          </div>
        </div>

        <div class="form-group">
          <label for="meeting_name" class="col-sm-2 col-sm-offset-1 control-label">会议名称</label>
          <div class="col-sm-4">
            <input type="text" class="form-control" id="meeting_name" 
                 placeholder="请输入会议名称">
          </div>
          
        </div>
        <div class="form-group">
          <label for="meeting_num" class="col-sm-2 col-sm-offset-1 control-label">参会人数</label>
          <div class="col-sm-4">
            <input type="text" class="form-control" id="meeting_num" 
                 placeholder="请输入人数">
          </div>
        </div>
        
        <div class="form-group">
          <label for="meeting_content" class="col-sm-2 col-sm-offset-1 control-label">会议内容</label>
          <div class="col-sm-4">
            <textarea class="form-control" rows="3" id="meeting_content" placeholder="请输入会议内容"></textarea>
          </div>
        </div>
        
        
        <div class="form-group">
          <label for="apply_name" class="col-sm-2 col-sm-offset-1 control-label">申请人</label>
          <div class="col-sm-4">
            <input type="text" class="form-control" id="apply_name" 
                 placeholder="请输入申请人">
          </div>
        </div>
        
        <div class="form-group">
          <label for="phone" class="col-sm-2 col-sm-offset-1  control-label">联系电话</label>
          <div class="col-sm-4">
            <input type="text" class="form-control" id="apply_phone" 
                 placeholder="请输入联系电话">
          </div>
        </div>
        
        <div class="form-group">
          <label for="meeting_date" class="col-sm-2 col-sm-offset-1 control-label">会议日期</label>
          <div class="col-sm-4">
            <input type="text" class="form-control" id="meeting_date">
          </div>
        </div>
        
        <div class="form-group">
          <label for="meeting_time" class="col-sm-2 col-sm-offset-1 control-label">会议时间</label>
          <div class="col-sm-4">
            <!-- <input type="text" class="form-control" id="meeting_time" 
                 placeholder="请输入会议时间"> -->
              <select id="meeting_time" class="selectpicker" data-hide-disabled="true" data-live-search="false">
                <optgroup label="上午">
                  <option>08:30-11:00</option>
                </optgroup>
                <optgroup label="中午">
                  <option>11:00-13:00</option>
                </optgroup>
                <optgroup label="下午">
                  <option>14:00-15:30</option>
                  <option>15:30-16:30</option>
                  <option>16:30-17:30</option>
                </optgroup>
                <optgroup label="晚上">
                  <option>19:00-20:30</option>
                </optgroup>
              </select>
          </div>
        </div>
        
        <div class="form-group">
          <div class="col-sm-offset-3 col-sm-10">
            <button type="button" class="btn btn-success" id="now-submit">提交</button>
          </div>
        </div>
      </form>

      <div class="row">
        <div class="col-sm-7 col-sm-offset-1"><hr></div>
      </div>

      <div class="row">
        <div class="col-md-5 col-md-offset-2">
          <address><p class="pull-right">©深圳大学 计算机与软件学院</p><p>©2017 </p></address>
        </div>
      </div>
</div>
    
        
    <script type="text/javascript" src='/javascripts/jquery-1.10.2.min.js'></script>
    <!-- <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script> -->
    <script type="text/javascript" src='/javascripts/bootstrap.min.js' ></script>
    <script type="text/javascript" src='/javascripts/jquery-ui-datepicker.js' ></script>
    <script type="text/javascript" src='/javascripts/moment.js' ></script>
    <script type="text/javascript" src='/javascripts/bootstrap-select.js' ></script>
    <script type="text/javascript">
      jQuery.browser={};(function(){jQuery.browser.msie=false; 
      jQuery.browser.version=0;if(navigator.userAgent.match(/MSIE ([0-9]+)./)){ jQuery.browser.msie=true;jQuery.browser.version=RegExp.$1;}})();
    </script>

    <script type="text/javascript">
      $(document).ready(function(){
        //时间选择
        $('#meeting_date').datepicker({
           format: 'yyyy-mm-dd',
           minDate:0,
           maxDate:21
        });
        //初始化时间
        let date = moment().format('YYYY-MM-DD')
        $('#meeting_date').val(date)
        console.log('初始化时间',date)

        $('#now-submit').on("click",function(){
          let room_name = $('#room_name option:selected').val(),
              meeting_name = $('#meeting_name').val(),
              meeting_num = $('#meeting_num').val(),
              meeting_content = $('#meeting_content').val(),
              apply_name = $('#apply_name').val(),
              apply_phone = $('#apply_phone').val(),
              meeting_date = $('#meeting_date').val(),
              meeting_time = $('#meeting_time option:selected').val()

          if(!meeting_name || typeof meeting_name == 'undefined'){
            $('.modal-msg').modal('show')
            $('.modal-body').text('会议名称不能为空！')
            //alert('会议室编号或名称不能为空！')
            return false
          }
          if(meeting_name.length > 30){
            $('.modal-msg').modal('show')
            $('.modal-body').text('会议名称长度超过30！')
            //alert('会议名称长度超过30！')
            return false
          }
          if(!meeting_num || typeof meeting_num == 'undefined'){
            $('.modal-msg').modal('show')
            $('.modal-body').text('参会人数不能为空！')
            //alert('参会人数不能为空！')
            return false
          }
          if(!meeting_content || typeof meeting_content == 'undefined'){
            $('.modal-msg').modal('show')
            $('.modal-body').text('会议内容不能为空!')
            //alert('会议内容不能为空!')
            return false
          }
          if(meeting_content.length > 300){
            $('.modal-msg').modal('show')
            $('.modal-body').text('会议内容过长！')
            //alert('会议内容过长！')
            return false
          }
          if(!apply_name || typeof apply_name == 'undefined'){
            $('.modal-msg').modal('show')
            $('.modal-body').text('申请人不能为空！')
            //alert('申请人不能为空！')
          }
          if(!phone || typeof phone == 'undefined'){
            $('.modal-msg').modal('show')
            $('.modal-body').text('联系号码不能为空！')
            //alert('联系号码不能为空！')
          }

          console.log('check args',room_name,meeting_name,meeting_num,meeting_content,apply_name,apply_phone,meeting_date,meeting_time)

          meeting_date = meeting_date.substring(6)
          let temp_meeting_date = meeting_date.split('-')
          meeting_date = temp_meeting_date[0] + '月' + temp_meeting_date[1] + '日'
          console.log('meeting_date',meeting_date)

          let temp_meeting_time = meeting_time.substring(0,2),
              exact_meeting_time = ''
          console.log('临时截取时间：',temp_meeting_time)
          if(temp_meeting_time == '08'){
            exact_meeting_time = '上午' + meeting_time
            meeting_time = '上午'
          }
          if(temp_meeting_time == '11'){
            exact_meeting_time = '中午' + meeting_time 
            meeting_time = '中午'
          }
          if(temp_meeting_time == '14' || temp_meeting_time == '15' || temp_meeting_time == '16'){
            exact_meeting_time = '下午' + meeting_time
            meeting_time = '下午'
          }
          if(temp_meeting_time == '19'){
            exact_meeting_time = '晚上' + meeting_time
            meeting_time = '晚上'
          }
          console.log('meeting_time: ',meeting_time)
          console.log('exact_meeting_time: ',exact_meeting_time)

          $.ajax({
            url: '/manage/apply', 
            async: true,
            dataType: 'json',
            type: 'POST',
            data: {
              room_name:room_name,
              meeting_name:meeting_name,
              meeting_num:meeting_num,
              meeting_content:meeting_content,
              apply_name:apply_name,
              apply_phone:apply_phone,
              meeting_date:meeting_date,
              meeting_time:meeting_time,
              exact_meeting_time:exact_meeting_time
            },

            success: function(result){
              console.log('success')
              console.log(result)
              if(result.errCode == 0){
                //弹出模态框
                $('.result-modal').modal('show')
                $('.modal-body').text('申请操作成功，请等待审批。')
              }
              if(result.errCode == -1){
                //弹出模态框
                $('.result-modal').modal('show')
                $('.modal-body').text(result.errMsg)
              }
            },
            error: function(e){
              console.log("error");
              //console.error(e.message)
              $('.result-modal').modal('show')
              $('.modal-body').text('申请操作失败')
            },
           
          });
        });
        $('#success-btn').on("click",function(){
          window.location.reload()
        })
      });
    
  </script>
  <!-- 模态框 -->
    <!-- Button trigger modal -->

    <!-- Modal -->
    <div class="modal fade modal-msg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="data-modal">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="gridSystemModalLabel">提示</h4>
        </div>
        <div class="modal-body">

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default sure" data-dismiss="modal">确定</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 申请结果模态框 -->
  <div class="modal fade result-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="result-modal">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="gridSystemModalLabel">提交结果</h4>
        </div>
        <div class="modal-body">
        
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default sure" data-dismiss="modal" id="success-btn">确定</button>
        </div>
      </div>
    </div>
  </div>
  </body>
</html>